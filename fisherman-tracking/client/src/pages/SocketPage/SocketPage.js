import React, { Component } from 'react';
import openSocket from 'socket.io-client';
import axios from 'axios';

class SocketPage extends Component {

    constructor(props) {
        super(props);
        this.state = {
            id: "100",
            data: "",
            gps: [
                [8.545170, 124.565520 ],
                [8.545151, 124.565430 ],
                [8.545141, 124.565400 ],
                [8.546304, 124.563900 ],
                [8.546509, 124.563810 ],
                [8.546708, 124.563740 ],
                [8.546842, 124.563690 ],
                [8.546924, 124.563680 ],
                [8.546967, 124.563680 ],
                [8.546993, 124.563690 ],
                [8.547014, 124.563680 ],
                [8.547031, 124.563680 ],
                [8.547167, 124.563710 ],
                [8.547471, 124.563740 ],
                [8.547782, 124.563790 ],
                [8.548095, 124.563850 ],
                [8.548412, 124.563920 ],
                [8.548715, 124.563990 ],
                [8.549319, 124.564110 ],
                [8.549879, 124.564250 ],
                [8.550100, 124.564320 ],
                [8.550299, 124.564410 ],
                [8.550488, 124.564540 ],
                [8.550655, 124.564680 ],
                [8.550818, 124.564850 ],
                [8.550979, 124.565010 ],
                [8.551141, 124.565160 ],
                [8.551269, 124.565340 ],
                [8.552078, 124.566120 ],
                [8.568112, 124.570780 ],
                [8.573495, 124.570910 ],
                [8.573854, 124.570910 ],
                [8.574213, 124.570910 ],
                [8.574963, 124.570860 ],
                [8.575686, 124.570750 ],
                [8.576052, 124.570700 ],
                [8.576772, 124.570530 ],
                [8.577138, 124.570420 ],
                [8.577494, 124.570300 ],
                [8.577840, 124.570220 ],
                [8.578187, 124.570160 ],
                [8.578536, 124.570140 ],
                [8.578889, 124.570130 ],
                [8.579635, 124.570160 ],
                [8.580372, 124.570220 ],
                [8.580756, 124.570220 ],
                [8.581119, 124.570260 ],
                [8.581470, 124.570300 ],
                [8.581821, 124.570330 ],
                [8.582169, 124.570370 ],
                [8.582508, 124.570420 ],
                [8.582838, 124.570490 ],
                [8.583510, 124.570620 ],
                [8.583851, 124.570650 ],
                [8.584184, 124.570720 ],
                [8.584503, 124.570850 ],
                [8.584839, 124.570930 ],
                [8.585183, 124.570950 ],
                [8.585511, 124.571010 ],
                [8.585838, 124.571090 ],
                [8.586470, 124.571320 ],
                [8.587449, 124.571640 ],
                [8.587773, 124.571730 ],
                [8.588717, 124.572040 ],
                [8.589016, 124.572150 ],
                [8.589314, 124.572270 ],
                [8.589914, 124.572530 ],
                [8.590218, 124.572650 ],
                [8.590513, 124.572780 ],
                [8.590813, 124.572910 ],
                [8.591110, 124.573060 ],
                [8.591413, 124.573200 ],
                [8.591714, 124.573340 ],
                [8.592001, 124.573500 ],
                [8.592286, 124.573650 ],
                [8.592576, 124.573820 ],
                [8.592848, 124.574000 ],
                [8.593114, 124.574190 ],
                [8.593374, 124.574390 ],
                [8.593638, 124.574590 ],
                [8.593913, 124.574790 ],
                [8.594194, 124.574970 ],
                [8.594489, 124.575140 ],
                [8.595079, 124.575460 ],
                [8.595354, 124.575640 ],
                [8.595644, 124.575810 ],
                [8.595921, 124.576000 ],
                [8.596188, 124.576210 ],
                [8.596443, 124.576430 ],
                [8.596691, 124.576660 ],
                [8.596943, 124.576890 ],
                [8.597454, 124.577330 ],
                [8.597713, 124.577550 ],
                [8.597972, 124.577760 ],
                [8.598241, 124.577960 ],
                [8.598503, 124.578180 ],
                [8.598734, 124.578420 ],
                [8.598982, 124.578670 ],
                [8.599512, 124.579090 ],
                [8.599766, 124.579310 ],
                [8.600013, 124.579540 ],
                [8.600257, 124.579770 ],
                [8.600509, 124.579990 ],
                [8.600758, 124.580220 ],
                [8.601030, 124.580420 ],
                [8.601316, 124.580600 ],
                [8.601838, 124.581030 ],
                [8.602091, 124.581270 ],
                [8.602364, 124.581490 ],
                [8.602608, 124.581730 ],
                [8.604031, 124.583260 ],
                [8.604995, 124.584270 ],
                [8.605232, 124.584520 ],
                [8.605478, 124.584760 ],
                [8.607256, 124.588220 ],
                [8.605720, 124.587930 ],
                [8.605349, 124.587870 ],
                [8.604590, 124.587720 ],
                [8.604207, 124.587620 ],
                [8.603826, 124.587520 ],
                [8.603438, 124.587430 ],
                [8.602692, 124.587230 ],
                [8.601934, 124.587040 ],
                [8.601556, 124.586960 ],
                [8.601173, 124.586880 ],
                [8.600781, 124.586790 ],
                [8.600414, 124.586680 ],
                [8.600050, 124.586570 ],
                [8.599664, 124.586460 ],
                [8.599276, 124.586360 ],
                [8.598909, 124.586270 ],
                [8.598523, 124.586170 ],
                [8.598147, 124.586070 ],
                [8.597758, 124.585980 ],
                [8.597373, 124.585910 ],
                [8.596996, 124.585820 ],
                [8.596604, 124.585770 ],
                [8.596214, 124.585690 ],
                [8.595832, 124.585570 ],
                [8.595448, 124.585490 ],
                [8.595077, 124.585400 ],
                [8.594687, 124.585310 ],
                [8.594305, 124.585220 ],
                [8.593934, 124.585140 ],
                [8.593551, 124.585040 ],
                [8.593175, 124.584950 ],
                [8.592780, 124.584860 ],
                [8.592412, 124.584790 ],
                [8.592019, 124.584690 ],
                [8.591624, 124.584590 ],
                [8.591237, 124.584520 ],
                [8.590868, 124.584420 ],
                [8.590494, 124.584330 ],
                [8.590104, 124.584220 ],
                [8.589733, 124.584110 ],
                [8.589355, 124.584000 ],
                [8.588966, 124.583890 ],
                [8.588593, 124.583790 ],
                [8.588224, 124.583700 ],
                [8.587837, 124.583600 ],
                [8.587465, 124.583480 ],
                [8.587125, 124.583370 ],
                [8.586773, 124.583270 ],
                [8.586403, 124.583170 ],
                [8.586023, 124.583080 ],
                [8.585665, 124.582980 ],
                [8.585289, 124.582880 ],
                [8.584933, 124.582770 ],
                [8.584566, 124.582650 ],
                [8.584198, 124.582530 ],
                [8.583834, 124.582390 ],
                [8.583465, 124.582270 ],
                [8.583082, 124.582160 ],
                [8.582693, 124.582060 ],
                [8.582328, 124.581950 ],
                [8.581964, 124.581830 ],
                [8.581624, 124.581690 ],
                [8.581248, 124.581550 ],
                [8.580877, 124.581410 ],
                [8.580505, 124.581260 ],
                [8.580183, 124.581050 ],
                [8.579844, 124.580890 ],
                [8.579499, 124.580710 ],
                [8.579150, 124.580570 ],
                [8.578814, 124.580430 ],
                [8.578452, 124.580270 ],
                [8.578098, 124.580120 ],
                [8.577739, 124.579970 ],
                [8.577382, 124.579830 ],
                [8.577035, 124.579680 ],
                [8.576688, 124.579520 ],
                [8.576328, 124.579380 ],
                [8.575977, 124.579230 ],
                [8.575619, 124.579090 ],
                [8.575258, 124.578960 ],
                [8.574891, 124.578820 ],
                [8.574540, 124.578670 ],
                [8.574166, 124.578510 ],
                [8.573808, 124.578360 ],
                [8.573458, 124.578200 ],
                [8.573131, 124.578030 ],
                [8.572800, 124.577840 ],
                [8.572454, 124.577670 ],
                [8.572108, 124.577480 ],
                [8.571761, 124.577310 ],
                [8.571424, 124.577130 ],
                [8.571080, 124.576950 ],
                [8.570724, 124.576770 ],
                [8.570381, 124.576580 ],
                [8.570037, 124.576380 ],
                [8.569703, 124.576170 ],
                [8.568006, 124.575240 ],
                [8.567319, 124.574870 ],
                [8.566962, 124.574680 ],
                [8.565226, 124.573840 ],
                [8.564875, 124.573680 ],
                [8.563131, 124.572940 ],
                [8.562442, 124.572620 ],
                [8.559644, 124.571370 ],
                [8.552549, 124.569500 ],
                [8.552167, 124.569370 ],
                [8.551789, 124.569240 ],
                [8.551423, 124.569130 ],
                [8.551061, 124.569010 ],
                [8.549959, 124.568630 ],
                [8.549598, 124.568490 ],
                [8.549248, 124.568370 ],
                [8.548584, 124.568150 ],
                [8.548216, 124.568060 ],
                [8.547851, 124.568010 ],
                [8.546738, 124.567910 ],
                [8.546356, 124.567850 ],
                [8.545649, 124.567660 ],
                [8.545322, 124.567440 ],
                [8.545067, 124.567170 ],
                [8.544868, 124.566830 ],
                [8.544756, 124.566520 ],
                [8.544771, 124.566240 ],
                [8.544862, 124.566020 ],
                [8.544981, 124.565810 ],
                [8.545141, 124.565570 ],
                [8.545141, 124.565560 ],
                [8.545142, 124.565560 ],
                [8.545140, 124.565560 ],
                [8.545147, 124.565560 ],
                [8.545146, 124.565550 ],
                [8.545140, 124.565550 ],
                [8.545132, 124.565540 ],
                [8.545152, 124.565540 ],
                [8.545167, 124.565520 ],
                [8.545172, 124.565520 ],
                [8.545177, 124.565510 ],
                [8.545186, 124.565530 ],
                [8.545185, 124.565540 ],
                [8.545191, 124.565540 ],
                [8.545197, 124.565540 ],
                [8.545206, 124.565560 ],
            ],
            sending: false,
            counter: 0,
            response: ""
        };

        const host = window.location.host
        this.socket = openSocket(host);
        this.sendHandler = this.sendHandler.bind(this);
    }

    componentDidMount() {
        this.receivedSocketIO();
        console.log("socket ->", this.socket);
    }

    componentWillUnmount = () => {
        this.disconnectSockerIO();
    }

    receivedSocketIO = () => {
        this.socket.on(`msg_recv`, (msg) => {
            console.log("msg -> ", msg);
        });
    }

    sendSocket = () => {
        console.log("-- emit socket --");
        this.socket.emit(`msg_send`, {
            data: "hello world"
        });
    }

    disconnectSockerIO = () => {
        this.socket.disconnect();
    }


    sendHandler() {
        console.log("-- send scoket --");
        this.sendSocket();
    }


    sendRequest = () => {
        const id = this.state.id;
        const request = `https://expander-system.herokuapp.com/api/v1/esp/save-gps?node_id=${id}&lat=${this.state.gps[this.state.counter][0]}&long=${this.state.gps[this.state.counter][1]}&datetime=09:57:20-14/3/2020`;

        axios.get(request)
            .then((res) => {
                console.log(res);
                this.setState({ counter: this.state.counter + 1, response: res.data, sending: false });
            }).catch((err) => {
                this.setState({ response: err + "" });
            });
    }

    sendGps = () => {
        this.setState({ sending: true, response: "" });
        this.sendRequest();
    }


    render() {
        return (
            <div className="container">
                <div className="row">
                    <div className="col md-12 text-center bg-warning">Socket Page</div>
                    <div className="col-md-12">
                        {/* <div className="row mt-5 bg-primary">
                            <div className="col-md-6 text-center">
                                <div className="d-flex flex-column p-2">
                                    <h4>Send:</h4>
                                    <button className="btn btn-info" onClick={this.sendHandler}>Send now</button>
                                </div>
                            </div>
                            <div className="col-md-6 text-center bg-info p-2">
                                <div className="d-flex flex-column">
                                    <h4>Recieved:</h4>
                                    <h4 className="badge badge-warning">
                                        { this.state.data }    
                                    </h4>
                                </div>
                            </div>
                        </div> */}
                        <div className="row mt-2 bg-danger">
                            <div className="col-md-12 d-flex">
                                <input 
                                    type="text"
                                    style={{ width: "50px" }}
                                    onChange={(e) => this.setState({ id: e.target.value }) }
                                    value={this.state.id}/>
                                <button
                                    className="btn btn-warning" 
                                    onClick={this.sendGps}
                                    disabled={this.state.sending}
                                >
                                    send gps data
                                </button>
                                
                                <div className="mt-1 ml-5">
                                    <p>{ this.state.response }</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    }
}

export {
    SocketPage
}